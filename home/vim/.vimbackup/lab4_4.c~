#include <msp430fg4618.h>
#include <msp430.h>
#include "../include/LCD_Ctrl.h"
#include "stdio.h"

// Lab 4 - Part A4




#define GREEN BIT2
#define ORANGE BIT1
#define LCD_SIZE 11

/* Exercises for C-code
 * 1. Write program to display the number 2 ( segments abdeg ) on the rightmost
 * seven segment display.
 * 2. Write program to display the number 2 ( segments abdeg ) on the leftmost
 * seven segment display.
 * 3. Write a C-language program that can display the numbers 0 - 9 and Letters A-F.
 * Program should count up from 0 to F and then repeat indefinitely
 * 4. Write a C-language program that counts up from 0 to 999 in decimal and displays this
 * count every tenth of a second if SW1 is pressed and begin counting down when SW2 is pressed
 */


unsigned int characters[] = {0x5f,0x06,0x6b,0x2f,0x36,0x3d,0x7d,0x07,0x7f,0x37,0x77,0x7c,0x59,0x6E,0x79,0x71};
unsigned char *LCDSeg = (unsigned char *) &LCDM3;

unsigned int interruptCnt = 0 ;
unsigned int cnt = 2 ;
int time[] = {0,0,0,0,0,0,0};

int main(void) {
    volatile unsigned char a;	// <Volatile>
    volatile unsigned int i; // <Volatile>

    WDTCTL = WDTPW + WDTHOLD; // Stop watchdog timer

    // Clock Set up
    CCTL0 = CCIE;	// Set up Timer+Clock
    TACTL = TASSEL_1 + MC_1; // [timerA -> ACLK][MODE: UP]
    TACCR0 = 0xCCC ;	// TACCR0 is the upper limit of the timer = 32768

    P2DIR |= GREEN+ORANGE; // Set Px as output to be able to turn on LED
    P2OUT = 0x00 ;

    Init_LCD();

    __enable_interrupt();
    __bis_SR_register(LPM0 + GIE); // LPM0 with interrupts enabled


}

// Every tenth of a second: (1/10) = no.Ticks/CPUFREQ
#pragma vector = TIMERA0_VECTOR
__interrupt void Timer_A (void){
    P2OUT ^= ORANGE ;
    // SW1 is hit count up
    if ( P1IN == BIT0 ){
        time[0]++;
    }
    // SW2 is hit count down.
    else if ( P1IN == BIT1 ){
        time[0]-- ;
    }
    int i = 0 ;
    for ( i = 0 ; i < 3 ; i++ ){
        if ( time[i]/10 == 1 ){
            if ( i < 2 ){
                time[i+1]++ ;
            }
            else{
                time[i] = 0 ;
            }
            time[i] = 0 ;
        }
        else if (time[i] < 0 ){
            if ( i < 2 ){
                time[i+1]-- ;
                time[i] = 9 ;
            }
            else{
                time[i] = 9 ;
            }
        }
    }
    LCDSeg[0] = characters[time[0]];
    LCDSeg[1] = characters[time[1]];
    LCDSeg[2] = characters[time[2]];
}
