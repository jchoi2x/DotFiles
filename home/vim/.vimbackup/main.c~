#include <msp430fg4618.h>
#include <msp430.h>
#include "../include/LCD_Ctrl.h"
#include "../include/Init_Interrupts.h"


#define GREEN BIT2
#define ORANGE BIT1
#define RED BIT0

int time[] = { 0, 0, 0, 0, 0, 0, 0 };

int main(void) {
    volatile unsigned char a; // <Volatile>
    volatile unsigned int i; // <Volatile>

    // Stop watchdog timer
    WDTCTL = WDTPW + WDTHOLD;

    // Set LEDS
    P2DIR |= GREEN + ORANGE + RED;
    P2OUT = 0x00;


    Init_LCD();
    init_Interrupts(0xCCC);
    init_UART();

}

// Every tenth of a second: (1/10) = no.Ticks/CPUFREQ
#pragma vector = TIMERA0_VECTOR
__interrupt void Timer_A(void) {

    P2OUT ^= RED ;
    // SW1 is hit count up
    if (P1IN == BIT0) {
        time[0]++;
    }
    // SW2 is hit count down.
    else if (P1IN == BIT1) {
        time[0]--;
    }
    int i = 0;
    for (i = 0; i < 3; i++) {
        if (time[i] / 10 == 1) {
            if (i < 2) {
                time[i + 1]++;
            } else {
                time[i] = 0;
            }
            time[i] = 0;
        } else if (time[i] < 0) {
            if (i < 2) {
                time[i + 1]--;
                time[i] = 9;
            } else {
                time[i] = 9;
            }
        }
    }
    LCDSeg[0] = characters[time[0]];
    LCDSeg[1] = characters[time[1]];
    LCDSeg[2] = characters[time[2]];
}
